<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHẦN THI TĂNG TỐC (Chấm Điểm Đội)</title>
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-database.js"></script>

  <style>
    /* ===== Tổng quan & nền neon động (lam - tím) ===== */
    :root{
      --bg1: #121216;
      --bg2: #181824;
      --accent1: #00d4ff;
      --accent2: #9b6bff;
      --glass: rgba(255,255,255,0.04);
    }
    html,body{
      height:100%;
      margin:0;
      padding:0;
      font-family: Inter, "Segoe UI", Roboto, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: linear-gradient(180deg,var(--bg2),var(--bg1));
      overflow:hidden; /* khóa cuộn / xê dịch */
      touch-action: none; /* khóa gesture */
    }

    /* Animated soft neon background */
    .neon-bg {
      position:fixed;
      inset:0;
      z-index:0;
      filter: blur(60px);
      opacity:0.45;
      background:
        radial-gradient(30% 30% at 20% 30%, rgba(0,212,255,0.14), transparent 12%),
        radial-gradient(25% 25% at 80% 70%, rgba(155,107,255,0.12), transparent 15%),
        radial-gradient(20% 20% at 50% 20%, rgba(0,212,255,0.08), transparent 12%);
      animation: bgFloat 18s linear infinite;
      pointer-events:none;
    }
    @keyframes bgFloat {
      0% { transform: translate(0,0) scale(1); }
      50% { transform: translate(-4%, 3%) scale(1.03); }
      100% { transform: translate(0,0) scale(1); }
    }

    /* Container chính */
    .app {
      position:relative;
      z-index:2;
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      box-sizing:border-box;
    }

    .card {
      width:100%;
      max-width:780px;
      border-radius:16px;
      padding:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      box-shadow: 0 8px 40px rgba(0,0,0,0.6);
      color:#e8eef6;
      position:relative;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:12px;
    }

    h1 { margin:6px 0 0 0; font-size:1.2rem; letter-spacing:0.6px; color:#dff7ff;}
    .sub { color: #bcdff0; font-size:0.9rem; opacity:0.9; }

    /* ROLE selection */
    .roles { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:6px; }
    .btn-role {
      padding:12px 18px; border-radius:10px; border:none; cursor:pointer;
      font-weight:600; font-size:0.95rem; transition:transform .18s, box-shadow .18s;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
      color:#06121a;
    }
    .btn-role:active { transform: translateY(2px); }
    .btn-green{ background:#27ae60; }
    .btn-teal{ background:#00d4ff; color:#012; }
    .btn-red{ background:#ff6b6b; }

    /* Teacher screen layout */
    .teacher-controls { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:8px; }
    .teacher-controls button {
      padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:600;
      background:linear-gradient(180deg,#3b82f6,#2256d6); color:#fff;
      box-shadow:0 8px 24px rgba(35,82,150,0.28);
    }

    #countdown-display { font-size:2.2rem; font-weight:800; color:var(--accent1); text-shadow:0 6px 18px rgba(0,212,255,0.12); }

    /* Teams status */
    #teams-status { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:12px; width:100%; }

    .team-box {
      min-width:110px; padding:10px; border-radius:10px; text-align:center; color:#041018;
      font-weight:700; box-shadow: 0 4px 14px rgba(0,0,0,0.5);
      background:linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.75));
    }

    /* STUDENT screen */
    .student-area { display:flex; flex-direction:column; align-items:center; gap:8px; width:100%; }
    #team-name-display { font-size:1.1rem; font-weight:800; color:#dff7ff; }
    #buzzer-button {
      width: 78vw; max-width:360px; height:78vw; max-height:360px;
      border-radius:50%;
      border:6px solid rgba(255,255,255,0.06);
      /* CHỈNH SỬA: Font chữ to hơn, đậm hơn và nổi bật hơn */
      font-size: 4rem; /* TĂNG KÍCH THƯỚC CHỮ */
      font-weight: 900;
      color: #fff; /* CHỮ MÀU TRẮNG */
      text-shadow:
        0 0 10px rgba(255, 255, 255, 0.9), /* Bóng trắng sắc nét */
        0 0 20px var(--team-glow), /* Bóng màu team glow */
        0 0 40px var(--team-glow); /* Mở rộng bóng màu team */
      /* HẾT CHỈNH SỬA */
      display:flex; align-items:center; justify-content:center;
      transition: transform .12s, box-shadow .25s, background .25s;
      position:relative; overflow:visible;
    }

    /* IMPORTANT: .disabled is visual-only (keeps click events) */
    #buzzer-button.disabled { opacity:0.5; transform:scale(.995); }
    /* .no-pointer will actually block clicks (used when eliminated or totally frozen) */
    #buzzer-button.no-pointer { pointer-events: none !important; }

    /* Neon glow controlled via CSS variables set in JS */
    #buzzer-button.glow {
      box-shadow:
        0 0 30px 6px var(--team-glow),
        inset 0 0 80px 8px rgba(255,255,255,0.06);
      color: #fff;
    }
    #buzzer-button.pulse-once::after {
      content:"";
      position:absolute; left:50%; top:50%; transform:translate(-50%,-50%) scale(0);
      width:6px; height:6px; border-radius:50%;
      background:var(--team-glow);
      opacity:.9;
      animation: ringPulse .8s forwards;
      z-index:0;
    }
    @keyframes ringPulse { to { transform:translate(-50%,-50%) scale(10); opacity:0; } }

    .shake { animation: shake .42s; }
    @keyframes shake {
      0%,100%{ transform:translateX(0); } 25%{ transform:translateX(-8px);} 50%{ transform:translateX(8px);} 75%{ transform:translateX(-4px); }
    }

    /* Freeze overlay */
    #freeze-overlay {
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:linear-gradient(180deg, rgba(4,8,16,0.72), rgba(2,4,8,0.82));
      color:#e6fbff;
      font-weight: 900;
      font-size: 1.8rem;
      text-align: center;
      padding: 20px;
      text-shadow:
        0 0 8px #ff6b6b,
        0 0 16px rgba(255, 107, 107, 0.7);
      border-radius:12px;
      opacity:0; pointer-events:none; transition:opacity .25s;
      z-index:6;
      box-shadow: 0 0 30px rgba(0,212,255,0.06);
    }
    #freeze-overlay.active { opacity:1; pointer-events:auto; }

    /* Responsive tweaks */
    @media (max-width:480px){
      h1 { font-size:1rem; }
      .card { padding:14px; border-radius:12px; }
      #buzzer-button { font-size: 3rem; max-width:320px; max-height:320px; } /* Điều chỉnh font size cho mobile */
      #countdown-display { font-size:1.6rem; }
    }
  </style>
</head>
<body>

  <div class="neon-bg" aria-hidden="true"></div>

  <div class="app">
    <div class="card" role="application">
      <h1>Buzzer Neon Pro</h1>
      <div class="sub">Chọn vai trò / Chọn đội — tối ưu cho mobile (khóa zoom & xê dịch)</div>

      <div id="role-selection" style="margin-top:10px; width:100%; display:flex; flex-direction:column; align-items:center;">
        <div class="roles" style="margin-top:8px;">
          <button id="btn-teacher" class="btn-role btn-teal">Giáo viên</button>
          <button class="btn-role btn-role-team btn-role-team-red" data-color="red" style="background:#ff6b6b;">Đội Đỏ</button>
          <button class="btn-role btn-role-team btn-role-team-blue" data-color="blue" style="background:#00d4ff;">Đội Xanh</button>
          <button class="btn-role btn-role-team btn-role-team-green" data-color="green" style="background:#7ef0a6;">Đội Lá</button>
          <button class="btn-role btn-role-team btn-role-team-yellow" data-color="yellow" style="background:#ffd86b; color:#041018;">Đội Vàng</button>
          <button class="btn-role btn-role-team btn-role-team-purple" data-color="purple" style="background:#9b6bff;">Đội Tím</button>
        </div>
      </div>

      <div id="teacher-screen" style="display:none; width:100%; margin-top:12px;">
        <div style="display:flex;flex-direction:column;align-items:center;width:100%;">
          <div id="result-display" style="min-height:28px;color:var(--accent2);font-weight:800;margin-bottom:6px;"></div>
          <div class="teacher-controls">
            <button id="start-button">Bắt đầu lượt</button>
            <button id="end-round-button" style="display:none;background:#00c2a8;">Kết thúc lượt</button>
            <button id="master-reset-button" style="background:#ff6b6b;">Reset tổng</button>
          </div>
          <div id="countdown-display" style="margin-top:8px;">CHỜ LỆNH</div>
          <div id="teams-status"></div>
        </div>
      </div>

      <div id="student-screen" style="display:none; width:100%; margin-top:12px;">
        <div class="student-area">
          <div id="team-name-display">ĐỘI CỦA BẠN</div>
          <div style="position:relative; width:100%; display:flex; justify-content:center; align-items:center;">
            <div id="freeze-overlay">ĐÃ BẤM - CHỜ KẾT QUẢ</div>
            <button id="buzzer-button" class="disabled no-pointer" aria-disabled="true">CHỜ GIÁO VIÊN</button>
          </div>
          <div id="buzzer-status" style="opacity:0.9; margin-top:6px;">TRẠNG THÁI: CHỜ</div>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    // Prevent pinch-zoom & double-tap zoom on many browsers
    document.addEventListener('gesturestart', (e) => { e.preventDefault(); }, { passive:false });
    let lastTouch = 0;
    document.addEventListener('touchstart', (e) => {
      const now = Date.now();
      if (now - lastTouch <= 300) e.preventDefault(); // block double-tap zoom
      lastTouch = now;
    }, { passive:false });
  </script>

    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']] 
            },
            startup: {
                typeset: false 
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; display: flex; align-items: flex-start; justify-content: center; min-height: 100vh; background-color: #282c34; padding: 20px; color: #fff; }
        h1 {
    color: red; /* Tiêu đề phụ sẽ có màu xanh sáng */
}
        /* KHUNG TRÒ CHƠI */
        .game-container { 
            background-color: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); 
            width: 90%; 
            max-width: 1050px; 
            color: #333;
            margin-right: 30px; /* Khoảng cách với bảng điểm */
        }
        
        /* BẢNG ĐIỂM */
        #score-board-container {
            width: 250px;
            padding: 20px;
            border-radius: 10px;
            background-color: #3c414d;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); 
            display: none; /* Ban đầu ẩn, chỉ hiện khi game bắt đầu */
        }
        .team-score-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            color: white;
            transition: transform 0.2s;
        }
        .team-score-item:hover {
            transform: scale(1.03);
        }
        .team-name { font-size: 1.1em; }
        .team-score { font-size: 1.8em; }

        /* NÚT ĐIỀU CHỈNH ĐIỂM */
        .score-control button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            margin-left: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 900;
            transition: background 0.2s;
            line-height: 1; /* Căn giữa ký tự */
        }
        .score-control button:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        /* MÀU ĐỘI */
        .team-red { background-color: #e74c3c; }
        .team-blue { background-color: #3498db; }
        .team-green { background-color: #2ecc71; }
        .team-yellow { background-color: #f1c40f; color: #333; }
        .team-purple { background-color: #9b59b6; }
        
        /* HEADER VÀ CÂU HỎI */
        .header { display: flex; justify-content: flex-start; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 15px; }
        .question-box { margin-bottom: 25px; }
        .question-number { font-size: 2em; color: #2A52BE; margin-bottom: 5px; }
        .question-text { font-size: 2.3em; margin-bottom: 20px; font-weight: 500; }
        .options-container { display: flex; flex-direction: column; gap: 10px; }
        .option { padding: 12px; border: 1px solid #ccc; border-radius: 8px; cursor: pointer; transition: background-color 0.2s, border-color 0.2s; font-size: 2em; }
        .option:hover:not(.disabled) { background-color: #e9e9e9; border-color: #aaa; }
        .option.correct { background-color: #d4edda; border-color: #c3e6cb; }
        .option.incorrect { background-color: #f8d7da; border-color: #f5c6fb; }
        .option.disabled { cursor: default; opacity: 0.6; }
        .button-start { padding: 15px 30px; font-size: 2.2em; cursor: pointer; background-color: #5cb85c; color: white; border: none; border-radius: 8px; transition: background-color 0.2s; }
        .button-start:hover { background-color: #4cae4c; }
        .result-message { margin-top: 15px; font-size: 2.2em; font-weight: bold; }
        .math { font-style: italic; font-weight: 600; }
        #game-content { display: none; }
    </style>
</head>
<body>

    <div class="game-container">
        <h1>Chỉ được bấm khi nút BẤM xuất hiện, bấm trước sẽ bị loại</h1>
	<button id="startButton" class="button-start">VÒNG 1</button>
        
        <div id="game-content">
            <div class="header">
                </div>

            <div class="question-box">
                <div class="question-number">Câu hỏi <span id="current-q-number">1</span>/25</div>
                <div class="question-text" id="question-text"></div>
            </div>

            <div class="options-container" id="options-container">
                <div class="option" data-answer="A">A. <span id="option-a"></span></div>
                <div class="option" data-answer="B">B. <span id="option-b"></span></div>
                <div class="option" data-answer="C">C. <span id="option-c"></span></div>
                <div class="option" data-answer="D">D. <span id="option-d"></span></div>
            </div>

            <div class="result-message" id="result-message"></div>
            <button id="nextQuestionButton" class="button-start" style="display: none; margin-top: 20px;">Câu hỏi tiếp theo >></button>
        </div>

        <div id="final-results" style="display: none; text-align: center; margin-top: 30px; color: #333;">
            <h2>KẾT THÚC TRÒ CHƠI!</h2>
            <p style="font-size: 1.5em;">Đã hoàn thành 25 câu hỏi. <br> Tổng kết điểm ở bảng bên cạnh.</p>
            <button class="button-start" onclick="location.reload()">Chơi Lại</button>
        </div>
    </div>
    
    <div id="score-board-container">
        <h2 style="text-align: center; color: #f1c40f;">Bảng Điểm Đội</h2>
        <div id="score-board">
            </div>
    </div>
    
    <script>
        const questions = [
            // 15 CÂU CƠ BẢN (A)
            { q: 'Cho CSC ($u_n$) có $u_1 = 5$, $d = -3$. Số hạng thứ tư $u_4$ là:', options: ['4', '-4', '-12', '2'], correct: 'B' },
            { q: 'Cho CSC ($u_n$) có $u_5 = 18$, $u_{10} = 38$. Công sai $d$ là:', options: ['2', '3', '4', '5'], correct: 'C' },
            { q: 'Cho CSC ($u_n$) có $u_1 = 2$, $d = 3$. Tổng $S_{10}$ là:', options: ['155', '310', '150', '95'], correct: 'A' },
            { q: 'CSC ($u_n$) được định nghĩa bởi hệ thức truy hồi nào sau đây:', options: ['$u_n = u_{n-1} + n$', '$u_n = u_{n-1} \\cdot 2$', '$u_n = u_{n-1} + 5$', '$u_n = u_1 + (n-1)d$'], correct: 'C' },
            { q: 'Cho CSC ($u_n$) có $u_1 = 5$, $d = 2$. Để tổng $S_n = 480$, số lượng số hạng $n$ là:', options: ['15', '18', '20', '24'], correct: 'C' },
            { q: 'Cho CSN ($u_n$) có $u_1 = -4$, $q = 3$. Số hạng thứ năm $u_5$ là:', options: ['-108', '-324', '324', '-400'], correct: 'B' },
            { q: 'Công thức tính tổng $n$ số hạng đầu tiên của CSC ($u_n$) là:', options: ['$S_n = \\frac{n(u_1 + u_n)}{2}$', '$S_n = u_1 \\frac{1 - q^n}{1 - q}$', '$S_n = u_1 + (n-1)d$', '$S_n = n(u_1 + u_n)$'], correct: 'A' },
            { q: 'Cho CSN ($u_n$) có $u_4 = 54$, $q = 3$. Số hạng đầu tiên $u_1$ là:', options: ['2', '6', '18', '162'], correct: 'A' },
            { q: 'Số hạng tổng quát $u_n$ của một CSN ($n \\ge 1$) được xác định bởi công thức nào:', options: ['$u_n = u_1 + (n-1)q$', '$u_n = u_1 \\cdot q^{n-1}$', '$u_n = u_1 \\cdot q^n$', '$u_n = u_1 \\cdot q + u_{n-1}$'], correct: 'B' },
            { q: 'Cho CSN ($u_n$) có $u_1 = 2$, $q = -3$. Tính tổng $S_4$:', options: ['-40', '122', '40', '-160'], correct: 'A' },
            { q: 'Công thức tính tổng $n$ số hạng đầu tiên của CSC theo $u_1$ và $d$ là:', options: ['$S_n = \\frac{n}{2}[2u_1 + (n-1)d]$', '$S_n = n \\cdot u_n$', '$S_n = \\frac{n}{2}[u_1 + d]$', '$S_n = u_1 \\cdot q^{n-1}$'], correct: 'A' },
            { q: 'Công thức tính tổng $n$ số hạng đầu tiên của CSN ($q \\ne 1$) là:', options: ['$S_n = u_1 (1 - q^n)$', '$S_n = u_1 + u_n$', '$S_n = u_1 \\frac{1 - q^n}{1 - q}$', '$S_n = \\frac{n}{2}[2u_1 + (n-1)q]$'], correct: 'C' },
            { q: 'Cho CSC ($u_n$) có $u_1 = 10$, $S_{10} = 205$. Hãy tìm $u_{10}$:', options: ['31', '21', '41', '35'], correct: 'A' },
            { q: 'Cho CSC ($u_n$) có $u_1 = -5$, $d = 4$. Công thức tính tổng $S_n$ là:', options: ['$S_n = n(2n - 7)$', '$S_n = n(4n - 9)$', '$S_n = 2n^2 - 5n$', '$S_n = n(4n - 10)$'], correct: 'A' },
            { q: 'CSN ($u_n$) được định nghĩa bởi hệ thức truy hồi nào sau đây:', options: ['$u_n = u_{n-1} + 3$', '$u_n = u_{n-1} + u_{n-2}$', '$u_n = 2u_{n-1}$', '$u_n = u_1 + 2^{n-1}$'], correct: 'C' },

            // 10 CÂU NHẬN DIỆN VÀ VIẾT SỐ HẠNG (B)
            { q: 'Dãy số nào sau đây là **cấp số cộng**?', options: ['1; 2; 4; 8', '1; 3; 5; 7', '1; -1; 1; -1', '1; 4; 9; 16'], correct: 'B' },
            { q: 'Dãy số nào sau đây là **cấp số nhân**?', options: ['2; 5; 8; 11', '10; 5; 2.5; 1.25', '1; 1; 2; 3; 5', '1; 3; 5; 7'], correct: 'B' },
            { q: 'Cho CSC ($u_n$) có $u_1 = 10$, $d = -2$. Ba số hạng đầu tiên là:', options: ['10; 12; 14', '10; 8; 6', '10; -20; 40', '10; 5; 0'], correct: 'B' },
            { q: 'Cho CSN ($u_n$) có $u_1 = 16$, $q = 0.5$. Ba số hạng đầu tiên là:', options: ['16; 8; 4', '16; 16.5; 17', '16; 32; 64', '16; 4; 1'], correct: 'A' },
            { q: 'Dãy số ($u_n$) với $u_n = 3n + 1$. Số hạng $u_3$ là:', options: ['7', '10', '4', '13'], correct: 'B' },
            { q: 'Dãy số ($u_n$) với $u_n = 2^{n+1}$. Số hạng $u_3$ là:', options: ['8', '16', '32', '10'], correct: 'B' },
            { q: 'Dãy số 5; 5; 5; 5 là:', options: ['Chỉ là cấp số cộng', 'Chỉ là cấp số nhân', 'Vừa là CSC, vừa là CSN', 'Không phải CSC, không phải CSN'], correct: 'C' },
            { q: 'Cho CSC ($u_n$) có $u_1 = 5$. Biết $u_3 = 11$. Công sai $d$ là:', options: ['3', '6', '5.5', '1'], correct: 'A' },
            { q: 'Cho CSN ($u_n$) có $u_1 = 2$. Biết $u_3 = 18$ ($q > 0$). Công bội $q$ là:', options: ['9', '4', '3', '6'], correct: 'C' },
            { q: 'Dãy số nào **không phải** CSC cũng **không phải** CSN?', options: ['2; 4; 6; 8', '2; 6; 18; 54', '1; 4; 2; 5', '10; 10; 10; 10'], correct: 'C' }
        ];

        let currentQuestionIndex = 0;
        
        const startButton = document.getElementById('startButton');
        const gameContent = document.getElementById('game-content');
        const questionText = document.getElementById('question-text');
        const qNumber = document.getElementById('current-q-number');
        const optionsContainer = document.getElementById('options-container');
        const resultMessage = document.getElementById('result-message');
        const finalResults = document.getElementById('final-results');
        const optionElements = optionsContainer.querySelectorAll('.option');
        const scoreBoardContainer = document.getElementById('score-board-container');
        const nextQuestionButton = document.getElementById('nextQuestionButton');

        // Dữ liệu và cấu hình cho 5 đội
        const teams = [
            { id: 'red', name: 'Đội Đỏ', colorClass: 'team-red', score: 0 },
            { id: 'blue', name: 'Đội Xanh', colorClass: 'team-blue', score: 0 },
            { id: 'green', name: 'Đội Lá', colorClass: 'team-green', score: 0 },
            { id: 'yellow', name: 'Đội Vàng', colorClass: 'team-yellow', score: 0 },
            { id: 'purple', name: 'Đội Tím', colorClass: 'team-purple', score: 0 },
        ];
        
        // Gắn sự kiện cho nút "Câu hỏi tiếp theo"
        nextQuestionButton.addEventListener('click', () => {
            currentQuestionIndex++;
            loadQuestion();
        });


        // ---------------------------------------------------
        // CHỨC NĂNG BẢNG ĐIỂM ĐỘI
        // ---------------------------------------------------

        function updateTeamScore(teamId, delta) {
            const team = teams.find(t => t.id === teamId);
            if (team) {
                team.score += delta;
                document.getElementById(`score-${teamId}`).textContent = team.score;
            }
        }

        function renderScoreBoard() {
            const board = document.getElementById('score-board');
            board.innerHTML = ''; // Xóa nội dung cũ
            
            teams.forEach(team => {
                const item = document.createElement('div');
                item.className = 'team-score-item ' + team.colorClass;
                item.innerHTML = `
                    <div class="team-info">
                        <div class="team-name">${team.name}</div>
                        <div class="team-score" id="score-${team.id}">${team.score}</div>
                    </div>
                    <div class="score-control">
                        <button onclick="updateTeamScore('${team.id}', 10)">+</button>
                        <button onclick="updateTeamScore('${team.id}', -5)">-</button>
                    </div>
                `;
                board.appendChild(item);
            });
            scoreBoardContainer.style.display = 'block';
        }


        // ---------------------------------------------------
        // CHỨC NĂNG TRÒ CHƠI
        // ---------------------------------------------------
        
        function renderMath() {
            const currentQ = questions[currentQuestionIndex];
            
            questionText.innerHTML = currentQ.q;
            optionElements.forEach((el, index) => {
                el.querySelector('span').innerHTML = currentQ.options[index];
            });

            if (window.MathJax) {
                // Xử lý các phần tử liên quan đến câu hỏi hiện tại
                MathJax.typesetPromise([questionText, optionsContainer]);
            }
        }

        function loadQuestion() {
            if (currentQuestionIndex >= questions.length) {
                endGame();
                return;
            }

            const currentQ = questions[currentQuestionIndex];
            
            // Ẩn nút "Câu hỏi tiếp theo"
            nextQuestionButton.style.display = 'none';

            // Reset trạng thái
            resultMessage.textContent = '';

            // Hiển thị số câu hỏi
            qNumber.textContent = currentQuestionIndex + 1;
            
            // Cấu hình các nút đáp án
            optionElements.forEach((el) => {
                el.classList.remove('correct', 'incorrect', 'disabled');
                el.onclick = () => checkAnswer(el, currentQ.correct);
            });
            
            // Yêu cầu xử lý và hiển thị công thức toán
            renderMath();
        }

        function highlightAndDisableAll(correctAnswer) {
             optionElements.forEach(el => {
                el.classList.add('disabled'); 
                el.onclick = null;
                if (el.getAttribute('data-answer') === correctAnswer) {
                    el.classList.add('correct'); 
                }
            });
            nextQuestionButton.style.display = 'block'; // Hiển thị nút chuyển câu
        }

        function checkAnswer(selectedElement, correctAnswer) {
            
            const selectedAnswer = selectedElement.getAttribute('data-answer');
            
            if (selectedAnswer === correctAnswer) {
                // TRẢ LỜI ĐÚNG: Đánh dấu đúng, hiển thị thông báo, vô hiệu hóa tất cả
                selectedElement.classList.add('correct');
                resultMessage.innerHTML = 'Chính xác! **Mời giáo viên cộng điểm cho đội.**';

                highlightAndDisableAll(correctAnswer);
                
            } else {
                // TRẢ LỜI SAI: Đánh dấu sai, vô hiệu hóa đáp án sai, cho phép chọn tiếp
                selectedElement.classList.add('incorrect');
                selectedElement.classList.add('disabled'); 
                selectedElement.onclick = null; 

                resultMessage.textContent = 'Chưa chính xác. Thử lại!';
            }
        }
        
        // Hàm bắt đầu game
        startButton.addEventListener('click', () => {
            startButton.style.display = 'none';
            gameContent.style.display = 'block';
            renderScoreBoard(); // Hiện bảng điểm đội
            loadQuestion();
        });

        function endGame() {
            gameContent.style.display = 'none';
            finalResults.style.display = 'block';
            scoreBoardContainer.style.display = 'block';
        }

        // Đưa hàm updateTeamScore ra global scope để các nút HTML có thể gọi
        window.updateTeamScore = updateTeamScore;
    </script>

</body>
</html>


